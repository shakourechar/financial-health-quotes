<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Daily Financial-Wellness Quote</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <style>
    *,::before,::after{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    html{background:transparent !important;}
    body{
      background:transparent !important;
      display:flex;justify-content:center;align-items:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:#e6edf3;line-height:1.5;overflow:auto;padding:0;
    }
    #card{
      width:92vw;max-width:680px;margin:auto;
      background:#21262d;border-radius:18px;
      padding:clamp(1.4rem,4vw,2.2rem) clamp(1.2rem,4vw,2.6rem);
      box-shadow:
        0 1px 1px rgba(255,255,255,.05) inset,
        0 12px 28px rgba(0,0,0,.45),
        0  6px 14px rgba(0,0,0,.35);
      transform-style:preserve-3d;perspective:1000px;
      opacity:0;transform:rotateX(18deg) translateY(50px) scale(.94);
      animation:fadeIn .8s cubic-bezier(.25,.8,.25,1) .15s forwards;
    }
    #text  {font-size:clamp(1.25rem,2.5vw + .75rem,1.8rem);letter-spacing:.02em}
    #author{margin-top:1rem;font-weight:600;color:#58a6ff;font-size:1.05rem}
    #stamp {margin-top:.4rem;font-size:.85rem;color:#8b949e}
    #newBtn{
      margin-top:1.6rem;padding:.6rem 1.3rem;border:none;border-radius:12px;
      background:#58a6ff;color:#0d1117;font-size:1rem;font-weight:600;cursor:pointer;
      transition:transform .15s ease,box-shadow .15s ease;
      box-shadow:0 3px 6px rgba(0,0,0,.25);
    }
    #newBtn:active  {transform:scale(.97) translateY(1px)}
    #newBtn:disabled{opacity:.6;cursor:progress}
    @keyframes fadeIn{to{opacity:1;transform:rotateX(0) translateY(0) scale(1);}}
  </style>
</head>

<body>
  <div id="card">
    <div id="text">Loading‚Ä¶</div>
    <div id="author"></div>
    <div id="stamp"></div>
    <button id="newBtn">Read Another Quote ‚ò∫Ô∏è</button>
  </div>

  <script>
    /* ---------- 1. local emergency list (used if quotes.json missing) ---------- */
    const localQuotes = [
      {q:"Pay yourself first‚Äîsave 10‚Äâ% of every paycheck.",                 a:"Common advice"},
      {q:"High-interest debt kills compounding‚Äîpay it fast.",               a:"Unknown"},
      {q:"Time in the market beats timing the market.",                     a:"Investing maxim"},
      {q:"Track every dollar; awareness is the first step toward control.", a:"YNAB principle"},
      {q:"Wealth is what you don‚Äôt spend‚Äîlive below your means.",           a:"Morgan Housel"}
    ];

    /* ---------- 2. load quotes.json once per session ---------- */
    let quoteListPromise = null;
    function loadQuoteList() {
      if (!quoteListPromise) {
        quoteListPromise = fetch("./quotes.json", { cache: "no-store" })
          .then(r => r.ok ? r.json() : [])
          .catch(() => []);
      }
      return quoteListPromise;
    }

    /* ---------- 3. pick a random quote (never repeat immediately) ---------- */
    async function fetchQuote() {
      const list = await loadQuoteList();
      const pool = Array.isArray(list) && list.length ? list : localQuotes;

      if (pool.length === 1) return pool[0];        // only one available‚Äîjust return it

      let pick;
      do pick = pool[Math.floor(Math.random() * pool.length)];
      while (pick.q === current?.q);
      return pick;
    }

    /* ---------- 4. helpers ---------- */
    const $ = id => document.getElementById(id);
    const card = $("card"), text=$("text"), author=$("author"),
          stamp=$("stamp"), btn=$("newBtn");

    function show({q,a}) {
      text.textContent   = "üí° " + q;
      author.textContent = "‚Äî " + a;
      stamp.textContent  = "Shown for " +
        new Date().toLocaleDateString(undefined,
          {weekday:"long",year:"numeric",month:"long",day:"numeric"});
      card.style.animation="none";
      requestAnimationFrame(()=>card.style.animation="");
    }

    const msUntilTomorrow = () => {
      const n = new Date(), t = new Date(n);
      t.setHours(24,0,60,0);            // 00:01 tomorrow
      return t - n;
    };

    /* ---------- 5. daily quote logic ---------- */
    async function renderDaily() {
      const today  = new Date().toISOString().slice(0,10);
      const cached = JSON.parse(localStorage.getItem("finQuote")||"{}");
      current = cached;

      if (cached.date !== today || !cached.q) {
        current = await fetchQuote();
        localStorage.setItem("finQuote", JSON.stringify({...current,date:today}));
      }
      show(current);
    }

    /* ---------- 6. events ---------- */
    let current = null;
    btn.addEventListener("click", async () => {
      btn.disabled = true;
      current = await fetchQuote();
      show(current);
      setTimeout(()=>btn.disabled=false,300);
    });

    /* ---------- 7. init + schedule ---------- */
    renderDaily();
    setTimeout(()=>{renderDaily(); setInterval(renderDaily,86_400_000);},
               msUntilTomorrow());
  </script>
</body>
</html>
